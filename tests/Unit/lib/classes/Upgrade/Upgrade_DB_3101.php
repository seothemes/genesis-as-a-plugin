<?php
/**
 * Genesis Framework.
 *
 * WARNING: This file is part of the core Genesis Framework. DO NOT edit this file under any circumstances.
 * Please do all modifications in the form of a child theme.
 *
 * @package StudioPress\Genesis
 * @author  StudioPress
 * @license GPL-2.0-or-later
 * @link    https://my.studiopress.com/themes/genesis/
 */

namespace StudioPress\Genesis\Tests\Unit;

use Brain\Monkey\Functions;
use \StudioPress\Genesis\Upgrade\Upgrade_DB_3101 as Upgrader;

/**
 * Test Upgrade_DB_3100.
 */
class Upgrade_DB_3101_Test extends TestCase {
	/**
	 * Test upgrade method.
	 *
	 * @dataProvider data_upgrade
	 *
	 * @param string $setting  Assumed setting value.
	 * @param string $expected Expected setting value after search/replace.
	 */
	public function test_upgrade( $setting, $expected ) {
		Functions\when( 'date' )->justReturn( '2019' );
		Functions\when( 'genesis_get_option' )->justReturn( $setting );

		Functions\expect( 'genesis_update_settings' )
			->once()
			->with(
				[
					'footer_text' => $expected,
				]
			);

		( new Upgrader() )->upgrade();
	}

	/**
	 * Data provider for `test_upgrade` method.
	 *
	 * @return array
	 */
	public function data_upgrade() {
		return [
			'Setting has copyright symbol followed by current year' => [
				'Â© 2019 All Rights Reserved',
				'[footer_copyright] All Rights Reserved',
			],
			'Setting has named copyright entity followed by current year' => [
				'&copy; 2019 All Rights Reserved',
				'[footer_copyright] All Rights Reserved',
			],
			'Setting has decimal copyright entity followed by current year' => [
				'&#169; 2019 All Rights Reserved',
				'[footer_copyright] All Rights Reserved',
			],
			'Setting has hexadecimal copyright entity followed by current year' => [
				'&#x000A9; 2019 All Rights Reserved',
				'[footer_copyright] All Rights Reserved',
			],
			'Setting has the word copyright followed by current year' => [
				'Copyright 2019 All Rights Reserved',
				'Copyright 2019 All Rights Reserved',
			],
			'Setting has a year range'               => [
				'Copyright 1985-2019 All Rights Reserved',
				'Copyright 1985-2019 All Rights Reserved',
			],
			'Setting has the current year, but unpredictible surrounding text' => [
				'No stealing, 2019 is the year of this copyrighted content',
				'No stealing, 2019 is the year of this copyrighted content',
			],
			'Setting does not have the current year' => [
				'There is no year here, but stealing is still wrong',
				'There is no year here, but stealing is still wrong',
			],
			'Setting uses shortcode, but uses current year as "first" param' => [
				'[footer_copyright first="2019"] All Rights Reserved',
				'[footer_copyright first="2019"] All Rights Reserved',
			],
		];
	}
}
