<?php
/**
 * Genesis Framework.
 *
 * WARNING: This file is part of the core Genesis Framework. DO NOT edit this file under any circumstances.
 * Please do all modifications in the form of a child theme.
 *
 * @package StudioPress\Genesis
 * @author  StudioPress
 * @license GPL-2.0-or-later
 * @link    https://my.studiopress.com/themes/genesis/
 */

namespace StudioPress\Genesis\Tests\Unit;

use Brain\Monkey\Functions;
use Mockery;

/**
 * Test option/settings functions.
 *
 * @group settings
 */
class Options extends TestCase {

	/**
	 * Test `genesis_get_expiring_setting`.
	 *
	 * @covers ::genesis_get_expiring_setting
	 *
	 * @dataProvider data_genesis_get_expiring_setting
	 *
	 * @param string $current_time The current timestamp.
	 * @param string $expiration   The expiration to test with.
	 * @param mixed  $expected     The expected result.
	 */
	public function test_genesis_get_expiring_setting( $current_time, $expiration, $expected ) {
		Functions\expect( 'get_option' )
			->atLeast()
			->once()
			->andReturn( $expiration, 'Genesis' );

		Functions\when( 'delete_option' )->justReturn( true );

		$actual = genesis_get_expiring_setting( 'update', $current_time );
		self::assertEquals( $expected, $actual );
	}

	/**
	 * Data provider for testing genesis_get_expiring_setting().
	 *
	 * @return array
	 */
	public function data_genesis_get_expiring_setting() {
		return [
			'timestamps the same'        => [
				time(),
				time(),
				false,
			],
			'expiration 01 January 2012' => [
				time(),
				'1325376000',
				false,
			],
			'setting 01 January 3012'    => [
				time(),
				'32882284800',
				'Genesis',
			],
			'expiration = false'         => [
				time(),
				false,
				false,
			],
			'expiration = 0'             => [
				time(),
				'0',
				false,
			],
			'expiration = ""'            => [
				time(),
				'',
				false,
			],
			'expiration = " "'           => [
				time(),
				' ',
				false,
			],
			'expiration not an integer'  => [
				time(),
				'Genesis',
				false,
			],
			'expiration negative'        => [
				time(),
				'-1549994751',
				false,
			],
		];
	}

}
